# 릴처(Reelcher) 프로젝트 최종 기능 명세서 (Multi-Platform Version)

- 문서 버전: v2.0 (Multi-Platform)
- 업데이트 일자: 2025-08-18
- 문서 목적: 본 문서는 '릴처' 프로젝트의 기획, 디자인, 개발, QA 등 모든 과정에서 기준으로 삼는 유일하고 완전한 진실의 원천(Single Source of Truth)이다. 본 문서 외 다른 버전의 PRD는 참조하지 않는다.

## 목차
- [1. 프로젝트 개요](#1-프로젝트-개요)
  - [1.1. 프로젝트명](#11-프로젝트명)
  - [1.2. 핵심 가치 (Core Value)](#12-핵심-가치-core-value)
  - [1.3. 비즈니스 목표 및 전략](#13-비즈니스-목표-및-전략)
- [2. 기술 스택 및 개발 환경](#2-기술-스택-및-개발-환경)
  - [2.1. 핵심 기술 스택](#21-핵심-기술-스택)
  - [2.2. UIUX 구현 전략](#22-uiux-구현-전략)
  - [2.3. 배포 및 인프라 (Vercel)](#23-배포-및-인프라-vercel)
- [3. Apify 액터 상세 명세 및 연동 아키텍처](#3-apify-액터-상세-명세-및-연동-아키텍처)
  - [3.1. 사용 액터 목록](#31-사용-액터-목록)
  - [3.2. 연동 아키텍처](#32-연동-아키텍처)
- [4. 사용자 인증](#4-사용자-인증)
- [5. 핵심 기능: 키워드 기반 릴스 분석](#5-핵심-기능-키워드-기반-릴스-분석)
  - [5.1. 사용자 인터페이스 (UI)](#51-사용자-인터페이스-ui)
  - [5.2. 결과 데이터 테이블 명세](#52-결과-데이터-테이블-명세)
  - [5.3. 정렬 및 상호작용 기능](#53-정렬-및-상호작용-기능)
- [6. 부가 기능 상세 명세](#6-부가-기능-상세-명세)
- [7. 크레딧 시스템 및 결제](#7-크레딧-시스템-및-결제)
  - [7.1. 구독 플랜 (VAT 별도)](#71-구독-플랜-vat-별도)

  - [7.3. 크레딧 사용 정책](#73-크레딧-사용-정책)
  - [7.4. 공정 사용 정책 (결과 부족 시)](#74-공정-사용-정책-결과-부족-시)
  - [7.5. 결제 시스템 (토스페이먼츠)](#75-결제-시스템-토스페이먼츠)
- [8. 보안 요구사항](#8-보안-요구사항)
 - [부록 A. 비용 구조(원가 분석)](#부록-a-비용-구조원가-분석)
 - [부록 B. 단계별 로드맵](#부록-b-단계별-로드맵)

## 1. 프로젝트 개요

### 1.1. 프로젝트명
- 릴처 (Relcher)

### 1.2. 핵심 가치 (Core Value)
**멀티 플랫폼 숏폼 콘텐츠 분석 SaaS**: 인스타그램(Reels), 유튜브(Shorts), 틱톡(TikTok) 데이터에 대한 과학적 벤치마킹을 통해, 1인 사업가, 실무 마케터, 1인 크리에이터가 최소한의 리소스로 최대의 마케팅 효과를 거둘 수 있도록 데이터 기반 의사결정을 지원하는 합리적인 가격의 SaaS.

### 1.3. 비즈니스 목표 및 전략
- 핵심 전략: '박리다매, 시장 지배 전략'. 경쟁사 대비 압도적인 가성비를 무기로 초기 시장을 빠르게 선점하고, '미사용 크레딧'과 '부가 기능'을 통해 장기적인 수익성을 확보한다.
- 주요 성공 지표(KPI): 월간 활성 사용자(MAU), 유료 구독 전환율, 고객 이탈률(Churn Rate).

## 2. 기술 스택 및 개발 환경

### 2.1. 핵심 기술 스택
- 언어: TypeScript
- 프레임워크: Next.js (App Router)
- 데이터베이스: Supabase
- 인증: Supabase Auth
- 데이터 검증: Zod
- 결제 연동: 토스페이먼츠 (Toss Payments)
- 핵심 데이터 수집: Apify
- 상태 관리:
  - 서버 상태: React Query (@tanstack/react-query)
  - 클라이언트 상태: Zustand

### 2.2. UI/UX 구현 전략
- 기반: Tailwind CSS를 모든 스타일의 기초가 되는 뼈대로 사용한다.
- 메인 UI 컴포넌트: shadcn/ui를 사용하여 버튼, 입력창, 모달, 테이블 등 서비스의 표준적인 UI 요소를 구축한다. 코드 복사-붙여넣기 방식으로 높은 수준의 커스텀과 유지보수 용이성을 확보한다.
- 특수 효과: Magic UI는 온보딩, 핵심 지표 강조 등 한정된 상황에서만 선택적으로 도입한다.
- 사용 금지: Flowbite 등 shadcn/ui와 기능이 중복되는 라이브러리 사용 금지.
- AI 개발 지원: Kombai를 활용하여 피그마 디자인을 shadcn/ui 기반 코드로 신속 변환한다.

### 2.3. 배포 및 인프라 (Vercel)
- 배포 플랫폼: Vercel
- CI/CD: GitHub main 브랜치에 Push 시 자동 빌드/배포
- 인프라: Vercel Serverless Functions로 모든 API Route 및 백엔드 로직 실행
- 글로벌 CDN: 정적 자산을 전 세계에 빠르게 제공
- 보안: Vercel WAF 및 DDoS 보호 사용

## 3. Apify 액터 상세 명세 및 연동 아키텍처

### 3.1. 사용 액터 목록 (플랫폼별)

#### 3.1.1. Instagram 액터
- **Instagram Hashtag Scraper** (`upscale_jiminy/instagram-hashtag-scraper-task`)
  - 단가: 1,000건당 $2.30
  - 역할: 키워드 검색의 1단계(탐색). 특정 해시태그가 포함된 릴스 목록의 기본 정보 수집.
  - **베타 제한**: 무료 플랜에서 한 페이지(~30개)만 수집 가능
- **Instagram Scraper** (`upscale_jiminy/instagram-scraper-task`)
  - 단가: 1,000건당 $2.70
  - 역할: 2단계(심층 분석) 및 프로필 검색. 릴스 URL/프로필 URL 입력받아 상세 정보 추출.
- **Instagram Profile Scraper** (`upscale_jiminy/instagram-profile-scraper-task`)
  - 단가: 1,000건당 $2.30
  - 역할: 3단계(영향력 측정). 작성자 팔로워 수, 프로필 정보 추출.
- **Subtitle Extractor for Instagram** (`CVQmx5Se22zxPaWc1`)
  - 단가: 1,000건당 $3.80
  - 역할: 자막 추출 부가 기능.

#### 3.1.2. YouTube data v3 api (구글 자체 제공)
  - 역할: 키워드/URL 기반 YouTube Shorts 검색 및 메타데이터 추출.
  - 검색 타입: 키워드 검색(30/60/90/120개), URL 기반 유사 영상 검색(15/30/50개)

#### 3.1.3. TikTok 액터  
- **TikTok Scraper** (`clockworks/free-tiktok-scraper`)
  - 역할: 키워드/URL/프로필 기반 TikTok 영상 검색 및 메타데이터 추출.
  - 검색 타입: 키워드, URL 기반, 프로필 내 검색 (최소 좋아요 필터 지원)

### 3.2. 연동 아키텍처
- Apify의 역할: "원재료 공급" — 조건에 맞는 Raw Data만 수집하며 액터 간 데이터 공유는 없음.
- 릴처 서버(Vercel Serverless Function)의 역할: "데이터 가공 및 기능 구현"
  - 오케스트레이션(Chaining)
    1) 사용자가 '분석 시작' 클릭 시 1번 액터(Hashtag Task)를 "요청 개수 그대로" 단일 호출한다(30/60/90/120 중 선택값).
    2) 반환된 결과에서 릴스 URL 목록과 작성자 ID 목록을 중복 제거하여 추출한다.
    3) 2단계는 URL을 30개 단위 배치로 분할하여 모든 배치를 동시에 실행한다(예: 90개 → 30×3개 동시). 3단계는 username을 30개 단위로 순차 처리한다.
    4) 3개 단계의 작업을 병렬/순차 전략에 따라 끝까지 수행하고 결과를 통합한다.
  - 데이터 통합 및 필터링
    - 릴스 URL 또는 작성자 ID 기준으로 단일 통합 데이터로 병합
    - 업로드 기간, 최소 조회수 조건에 미달하는 데이터 필터링 (MVP: 최대 팔로워 수 제거)
  - 부가 기능 구현
    - 영상 다운로드: 통합 데이터의 다운로드 URL로 서버가 fetch 후 다운로드 스트림 제공
    - 자막 추출: 4번 액터 호출 → 반환 텍스트에서 타임스탬프 등 불필요 정보 제거 후 표시

## 4. 사용자 인증
- 로그인 수단: 구글(Google), 카카오(Kakao) 소셜 로그인만 제공
- 자체 회원가입 미제공: 이메일/비밀번호 방식 미지원
- 등록 흐름: 최초 소셜 인증 성공 시 Supabase `users` 테이블에 자동 계정 생성
- 세션 관리: Supabase Auth가 세션 관리, 클라이언트는 Supabase 라이브러리로 상태 확인

## 5. 핵심 기능: 멀티 플랫폼 숏폼 콘텐츠 분석

### 5.1. 플랫폼별 검색 기능

#### 5.1.1. Instagram
**검색 타입:**
- **키워드 검색**: 해시태그 기반 릴스 검색 (베타: 30개만 제공)
- **프로필 검색**: 특정 계정의 릴스 검색 (30/60/90/120개, 기간 필터 지원)

**특수 기능:**
- 협찬 콘텐츠 필터 (`paidPartnership` 기반)
- 업로드 기간 설정 (7일/15일/1개월/3개월/6개월/1년/직접입력)

#### 5.1.2. YouTube  
**검색 타입:**
- **키워드 검색**: 주제 기반 YouTube Shorts 검색 (30/60/90/120개)
- **URL 기반 검색**: 유사 영상 검색 (15/30/50개, 높은 API 사용량)

**특수 기능:**
- 주제별 키워드 추천 (15개 카테고리 × 10개 키워드)
- 고화질 MP4 추출 (`yt-dlp` 활용)

#### 5.1.3. TikTok
**검색 타입:**
- **키워드 검색**: 해시태그/키워드 기반 검색
- **URL 기반 검색**: 유사 영상 검색  
- **프로필 검색**: 특정 계정 내 영상 검색 (최소 좋아요 필터 지원)

### 5.2. 통합 사용자 인터페이스 (UI)
- **플랫폼 선택**: Instagram/YouTube/TikTok 탭 방식
- **검색 타입 선택**: 플랫폼별 지원 타입에 따라 동적 변경
- **결과 수 선택**: 플랫폼/검색타입별 차등 적용
- **필터 옵션**: 업로드 기간, 최소 조회수, 플랫폼별 특수 필터
- **결과 출력**: 통일된 테이블 형식으로 표시

### 5.2. 결과 데이터 테이블 명세

| 선택 | 썸네일 | 계정 | 조회수 | 좋아요 | 댓글 | 팔로워 | 캡션 |
|---|---|---|---:|---:|---:|---:|---|
| [ ] | (릴스 썸네일) | @계정ID | 1,200,000 | 120,000 | 3,200 | 250,000 | [캡션 확인] |

- 선택 체크박스: 각 행을 선택할 수 있는 체크박스 제공
- 숫자 포맷: M/K 축약 없이 3자리 콤마 표기(예: 1,200,000)
- 캡션 확인: 클릭 시 전체 캡션을 shadcn/ui `Dialog` 팝업으로 표시

#### 플랫폼별 추가 명세
- **Instagram**: 팔로워 수, 협찬 여부 (`paidPartnership`), 업로드 날짜/시간 분리 표시
- **YouTube**: 채널 구독자 수, 영상 제목, 영상 길이 (MM:SS), 업로드 날짜/시간 분리 표시  
- **TikTok**: 팔로워 수, 영상 길이 (MM:SS), 업로드 날짜/시간 분리 표시
- **공통**: 숫자에 천 단위 콤마, 좋아요 0/비공개시 "-" 표시

### 5.3. 정렬 및 상호작용 기능
- 정렬 기능
  - 기본 정렬: 최초 로딩 시 조회수 내림차순
  - 사용자 선택 정렬: [조회수순], [최신순] 버튼으로 즉시 재정렬(리로드 없음)
- 상호작용 기능 바(Bar)
  - 위치: 결과 테이블 상단 또는 하단 고정 바
  - 동작: 평상시 비활성화, 1개 이상 선택 시 활성화
  - 기능 버튼: [선택한 릴스 다운로드], [자막 추출(1개만 활성)], [엑셀로 내보내기]



## 6. 부가 기능 상세 명세
- 영상 다운로드
  - 동작: 선택된 릴스를 서버가 순차 다운로드 → zip 압축 → 파일 제공
  - 크레딧: 없음 (무료)
- 자막 추출
  - 동작: 1개 선택 시 버튼 활성 → 자막 추출 후 팝업 표시
  - 크레딧: 20 크레딧
- 엑셀 데이터 추출
  - 동작: 선택된 릴스만 또는 전체 결과 테이블을 .xlsx로 다운로드(옵션 제공)
  - 크레딧: 없음
- 링크 바로가기
  - 동작: 테이블의 썸네일/계정/캡션 버튼/아이콘을 통해 원본 인스타그램 게시물 또는 계정으로 새 탭 이동
  - 크레딧: 없음

## 7. 크레딧 시스템 및 결제

### 핵심 화폐 정책
- 전제: 모든 사용자 활동은 크레딧을 통해 측정/차감
- UX 단위: 검색/부가 기능은 10 또는 100 크레딧 배수로 선택/표시하여 사용성 최적화(자투리 모드 포함)
- 원가 기준: 1 크레딧의 API 원가는 약 3.2원(환율 1,450원/$, 액터 평균 단가 기반) — 가격 책정 참고 지표

### 7.1. 구독 플랜 (VAT 별도)

| 플랜 | 월 요금 | 제공 크레딧 |
|---|---:|---:|
| STARTER | 19,000원 | 2,000 |
| PRO | 49,000원 | 7,000 |
| BUSINESS | 119,000원 | 20,000 |

#### 7.1.1. FREE 플랜(제한적 무료 사용)
- 월 요금: 0원
- 월 기본 크레딧: 250
- 제약: 결과 수 선택은 30개만 허용(90/120 비활성화), 요청 쿨다운(예: 30초), 1일 최대 요청 횟수(예: 20회)
- 목적: 제품 온보딩/바이럴 확산, 유료 전환 퍼널 상단 확보


정책 구현
- 월 정기지급: 매월 1일 00:00 UTC에 `250` 크레딧을 사용자 계정에 자동 지급. 간편 버전으로 로그인 시 점검하여 월이 바뀌면 지급.
- Abuse 방지: Turnstile 필수, 레이트리밋 강화(`/api/search` IP/유저 기준), 개발자 화이트리스트는 운영 환경에서 비활성화 가능.



### 7.3. 크레딧 사용 정책 (플랫폼별)

#### 7.3.1. Instagram
**키워드 검색** (베타 제한: 30개만)
- 결과 30개: 100 크레딧

**프로필 검색**
- 결과 30개: 100 크레딧
- 결과 60개: 200 크레딧
- 결과 90개: 300 크레딧
- 결과 120개: 400 크레딧

#### 7.3.2. YouTube
**키워드 검색**
- 결과 30개: 50 크레딧
- 결과 60개: 100 크레딧
- 결과 90개: 150 크레딧
- 결과 120개: 200 크레딧

**URL 기반 검색** (높은 API 사용량)
- 결과 15개: 25 크레딧
- 결과 30개: 50 크레딧
- 결과 50개: 70 크레딧

#### 7.3.3. TikTok
**키워드/URL/프로필 검색**
- 결과 30개: 100 크레딧
- 결과 60개: 200 크레딧
- 결과 90개: 300 크레딧
- 결과 120개: 400 크레딧

#### 7.3.4. 부가 기능
- **영상 다운로드**: 5 크레딧(영상 1개당)
- **자막 추출**: 20 크레딧

### 7.4. 공정 사용 정책 (결과 부족 시)
- 선차감: 검색 시작 시 즉시 100(30개 선택) 또는 200(60개 선택) 크레딧이 차감된다.
- 정산 로직: 최종 반환된 결과 수를 기준으로 실제 사용 크레딧을 산출하고, 선차감액에서 초과 차감된 몫은 환불한다. 계산은 항상 정수 절사(Math.floor)로 수행한다.
  - 계산식: 실제사용크레딧 = \( \big\lfloor (실제 반환 수 / 30) * 100 \big\rfloor \)
  - 환불액: 환불크레딧 = 선차감크레딧 − 실제사용크레딧 (음수면 0으로 간주)
- 사용자 중단 정책: 사용자가 창을 닫거나 페이지 이탈로 검색이 중단되어도 선차감은 유지된다(환불 없음). 단, 시스템/네트워크 오류로 우리 서버가 실패한 경우에 한해 별도 정책에 따라 보상 가능.
- 안내 UX: 검색 시작 전 팝업에서 선차감/정산/환불 정책과 예상 차감 크레딧을 명확히 고지. 검색 완료 후 반환 발생 시 결과 모달/토스트로 환불 크레딧을 안내.
- 예시 1: 30개 선택(100 차감) → 실제 22개 반환
  - 실제사용: \( \lfloor (22/30)*100 \rfloor = \lfloor 73.33.. \rfloor = 73 \)
  - 환불: 100 − 73 = 27 크레딧 반환
- 예시 2: 60개 선택(200 차감) → 실제 45개 반환
  - 실제사용: \( \lfloor (45/30)*100 \rfloor = \lfloor 150 \rfloor = 150 \)
  - 환불: 200 − 150 = 50 크레딧 반환

### 7.5. 결제 시스템 (토스페이먼츠)
- 기능: 구독(자동결제)만 지원
- 워크플로우
  1) 사용자가 플랜/상품 선택 후 결제 요청
  2) 토스페이먼츠 결제창 호출
  3) 결제 완료 시 토스페이먼츠 서버가 웹훅(Webhook) URL 호출
  4) 서버는 결제 내역 검증 후 해당 유저의 크레딧/구독 상태를 DB에 업데이트

## 8. 보안 요구사항
- 행 수준 보안(RLS): 모든 테이블 RLS 활성화, 기본 DENY ALL. 각 사용자는 자신의 `users`, `search_history`에 대해서만 접근(auth.uid() 기반 정책).
- 입력값 검증: 모든 API Route/서버 액션 시작점에서 Zod 스키마로 외부 입력 즉시 검증
- 시크릿 관리: API 키, DB URL 등은 Vercel 환경변수·Supabase Secrets에 저장(하드코딩 금지)
- 요청 제한(Rate Limiting): 비용 유발 API(예: `/api/search`)에 `@upstash/ratelimit` 적용, IP 기준 분당 제한
- 의존성 관리: 배포 전 `depcheck` 실행, 미사용 패키지 제거로 번들 최적화 및 보안 강화
- CAPTCHA(봇 방지): 비용 유발/민감 흐름(예: `/api/search`, 결제 관련 라우트)에 Cloudflare Turnstile 또는 hCaptcha 적용
- 모니터링/로깅: Sentry로 에러/성능 트레이싱, Vercel Analytics/Observability 활성화, 구조화 로그와 알림 설정(에러율/지연 임계치 기반)
- 헤더 보안: 엄격한 CORS 설정과 CSP(Content-Security-Policy) 적용, 다운로드/압축 응답에 적절한 `Content-Disposition` 및 `Content-Type` 지정
 - 결제 웹훅 보안: 토스 웹훅 서명 검증(시그니처 헤더), 재전송 대비 멱등성 키(Idempotency-Key) 처리, 재실행 안전한 크레딧 업데이트
 - 크레딧 차감 트랜잭션: 검색/부가 기능 수행 전에 잔액 체크→예약(선차감)→완료 시 확정/실패·중단 시 전액 롤백. 결과 부족 시 비례 차감 후 잔여분 환불.
 - 데이터 보존/개인정보: 최소 수집 원칙, 보존기간/삭제 정책 명시, 로그의 PII 마스킹, Export 요청 대응 절차 정의
 - 레이트리밋 프로파일: 공개 페이지는 완화, 비용 유발 라우트는 엄격(예: `/api/search` IP당 1분 3회, 사용자별 1분 5회, 버스트 2)

## 부록 A. 비용 구조(원가 분석)

### 실제 Apify 액터별 비용 (2024년 기준)
- 환율: 1,350원/$ (2024년 12월 기준)

### Instagram 검색 비용
**키워드 검색 (3개 액터 순차 실행):**
- 1단계(hashtag scraper): 결과수 × $0.002 = 결과수 × 2.7원
- 2단계(scraper task): 결과수 × $0.0023 = 결과수 × 3.105원  
- 3단계(profile scraper): 결과수 × $0.0023 = 결과수 × 3.105원
- **총 비용**: 결과수 × $0.0066 = 결과수 × 8.91원

**프로필 검색 (1개 액터만 실행):**
- scraper task: 결과수 × $0.0023 = 결과수 × 3.105원

### TikTok 검색 비용
**키워드/프로필 검색 공통:**
- scraper: 결과수 × $0.003 = 결과수 × 4.05원

### 자막 추출 비용
- 자막 추출 액터: 1개당 $0.038 = 1개당 51.3원

### 비용 계산 예시
**Instagram 키워드 검색 30개 결과:**
- 30 × 8.91원 = 267.3원 (100크레딧 기준)
- 실제 원가율: 약 267%

**TikTok 검색 30개 결과:**
- 30 × 4.05원 = 121.5원 (100크레딧 기준)  
- 실제 원가율: 약 122%

## 부록 B. 단계별 로드맵

### Phase 1: 베타 출시 (현재)
**플랫폼**: Instagram(키워드 30개), YouTube, TikTok  
**인프라**: Vercel Free, Supabase Free, Apify Free  
**월 고정비**: 0원  
**제약사항**: Instagram 키워드 검색 30개 제한 (무료 플랜 한계)

### Phase 2: 초기 성장  
**목표**: 첫 유료 고객 확보  
**업그레이드**: Vercel Pro + Supabase Pro  
**월 고정비**: 약 68,150원  
**손익분기점**: STARTER 플랜 6명

### Phase 3: 플랫폼 확장
**업그레이드**: Apify Starter 플랜 ($39/월)  
**개선사항**: Instagram 키워드 검색 60-120개 지원  
**월 고정비**: 약 137,750원  
**손익분기점**: STARTER 플랜 13명

### Phase 4: 고도화 (예정)
**신규 기능**: 
- 추가 플랫폼 (네이버 블로그, 페이스북 등)
- AI 기반 콘텐츠 분석
- 경쟁사 모니터링  
- 브랜드별 대시보드

### 베타 특별 정책
- **무료 체험**: 최대 25명 동시 사용 지원  
- **Instagram 제약**: 키워드 검색만 30개로 제한 (프로필 검색은 제한 없음)
- **도입 시점**: 손익분기점 도달 후 Apify 유료 플랜 전환
